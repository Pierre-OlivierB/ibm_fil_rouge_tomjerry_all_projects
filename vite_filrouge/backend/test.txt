SELECT ebt.qtx_ener FROM energy_by_time as ebt, month_product as mp, time_period as tp WHERE tp.begin_hour="00:00:00" AND mp.label_name="janv";

SELECT tp.Id_time_period FROM time_period as tp WHERE tp.begin_hour="00:00:00" 

SELECT mp.Id_Month FROM month_product as mp WHERE mp.label_name="janv";


SELECT DISTINCT ebt.qtx_ener FROM energy_by_time as ebt, month_product as mp, time_period as tp WHERE ebt.Id_time_period=(SELECT tp.Id_time_period FROM time_period as tp WHERE tp.begin_hour="00:00:00") AND ebt.Id_Month=(SELECT mp.Id_Month FROM month_product as mp WHERE mp.label_name="janv");

----------------------

SELECT tf.name_field as name, cg.qtx_cult as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.Id_culture=5
AND cg.Id_culture=5
AND c.Id_culture=5
AND ica.date_cult_affilied = cg.date_cult;

*vérifier si les id_field sont présent dans la table is_treated
SELECT f.label_field
FROM field as f, is_treated as fit
WHERE f.Num_Field = fit.Num_Field

////////////////////////////////////////////

*mettre de la donnée de traitement
INSERT INTO `is_treated` (`Num_Field`, `Id_treatement`, `date_treatement`, `qtx_treat`) VALUES ('37', '6', '2024-03-25', '6.5'), ('31', '6', '2024-03-25', '6.5'), ('34', '6', '2024-03-25', '6.5');

!---------------------------------------------------------------------------
! DEMANDER A DRISS
!---------------------------------------------------------------------------

////////////////////////////////////////////

DELIMITER $$ 
DROP FUNCTION IF EXISTS WITH_BONUS $$
CREATE FUNCTION WITH_BONUS(NumField INT) RETURNS VARCHAR(50) 
BEGIN
	DECLARE bonusInclude VARCHAR(50) DEFAULT "";
	SELECT f.label_field INTO bonusInclude FROM field as f, is_treated as fit WHERE fit.Num_Field = NumField;
	IF bonusInclude IS NOT NULL THEN SET bonusInclude = `avec apport`;
	RETURN bonusInclude;
END
;
////////////////////////////////////////////
DELIMITER $$

DROP FUNCTION IF EXISTS WITH_BONUS $$

CREATE FUNCTION WITH_BONUS(@NumField int) RETURNS VARCHAR
AS
BEGIN
DECLARE @bonusInclude VARCHAR DEFAULT "";
	SELECT f.label_field INTO @bonusInclude 
	FROM field as f, is_treated as fit 
    WHERE fit.Num_Field = @NumField;
IF @bonusInclude IS NOT NULL THEN SET @bonusInclude = "avec apport" END IF;
RETURN @bonusInclude;
END $$;

////////////////////////////////////////////
---chat
////////////////////////////////////////////
DROP FUNCTION IF EXISTS WITH_BONUS;

CREATE FUNCTION WITH_BONUS(NumField INT) RETURNS VARCHAR
BEGIN
    DECLARE bonusInclude VARCHAR;
    
    SELECT f.label_field INTO bonusInclude 
    FROM field AS f, is_treated AS fit 
    WHERE fit.Num_Field = NumField;
    
    IF bonusInclude IS NOT NULL THEN
        SET bonusInclude = 'avec apport';
    END IF;
    
    RETURN bonusInclude;
END;

////////////////////////////////////////////

SELECT IFNULL(f.label_field, "sans apport")
FROM field as f, is_treated as fit
WHERE f.Num_Field = fit.Num_Field

////////////////////////////////////////////
SELECT f.Num_Field, IFNULL(qtx_treat, "sans traitement") as treatement
FROM field as f
LEFT JOIN is_treated as fit ON f.Num_Field = fit.Num_Field;
////////////////////////////////////////////
SELECT IFNULL(qtx_treat, "sans traitement") as treatement
FROM field as f
CROSS JOIN is_treated as fit
////////////////////////////////////////////
*New test
SELECT f.Num_Field, IF(fit.Num_Field IS NULL,"sans apport","avec apport") as treatement
FROM field as f
LEFT JOIN is_treated as fit ON f.Num_Field=fit.Num_Field

!-----------------------------------------------
CREATE FUNCTION `WITH_BONUS`(`NumField` INT) RETURNS VARCHAR(50) NOT DETERMINISTIC CONTAINS SQL SQL SECURITY DEFINER BEGIN DECLARE bonusInclude VARCHAR(50); SET bonusInclude =""; SELECT IF(fit.Num_Field IS NULL,"sans apport","avec apport") INTO bonusInclude FROM field as f LEFT JOIN is_treated as fit ON f.Num_Field=fit.Num_Field WHERE fit.Num_Field = NumField; RETURN bonusInclude; END

!-------------------------------------------------------
!-------------------------------------------------------
*---------------Betteraves------------------------------
!-------------------------------------------------------
!-------------------------------------------------------

SELECT tf.name_field as name, cg.qtx_cult as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.Id_culture=8
AND cg.Id_culture=8
AND c.Id_culture=8
AND ica.date_cult_affilied = cg.date_cult;

*---------------add content apport

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture=8
     AND cg.Id_culture=8
     AND c.Id_culture=8
     AND ica.date_cult_affilied = cg.date_cult;

!-------------------------------------------------------
!-------------------------------------------------------
*-----------------Cereales------------------------------
!-------------------------------------------------------
!-------------------------------------------------------

*est un Cereales

SELECT * FROM `culture`,`cereal` WHERE culture.`Id_culture`=cereal.Id_culture;

*tous

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data, f.num_field
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c, cereal as cer
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.Id_culture=cer.Id_culture
AND cg.Id_culture=cer.Id_culture
AND c.Id_culture=cer.Id_culture
AND ica.date_cult_affilied = cg.date_cult;

!-------------------------------------------------------
!-------------------------------------------------------
*------------------tot/sol------------------------------
!-------------------------------------------------------
!-------------------------------------------------------

*TEST

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.Id_culture=8
AND cg.Id_culture=8
AND c.Id_culture=8
AND ica.date_cult_affilied = cg.date_cult;

*TEST2

SELECT Id_culture, SUM(qtx_cult)
FROM cult_give
GROUP BY Id_culture

*TEST3

SELECT cg.Id_culture, SUM(cg.qtx_cult)
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
GROUP BY Id_culture

*TEST4

SELECT tf.name_field,cg.Id_culture, cg.qtx_cult
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
GROUP BY cg.Id_culture,tf.name_field

*TEST5

!Mauvaise piste

*TEST6

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND (ica.Id_culture=8
AND cg.Id_culture=8
AND c.Id_culture=8)
OR (ica.Id_culture=5
AND cg.Id_culture=5
AND c.Id_culture=5)
AND ica.date_cult_affilied = cg.date_cult;

*TEST7

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, sum(cg.qtx_cult) as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.date_cult_affilied = cg.date_cult
AND c.Id_culture IN (8,5)
AND cg.Id_culture IN (8,5)
AND c.Id_culture IN (8,5)
GROUP BY name,cg.qtx_cult;

*TEST8

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, sum(DISTINCT cg.qtx_cult) as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.date_cult_affilied = cg.date_cult
AND c.Id_culture IN (8,5)
AND cg.Id_culture IN (8,5)
AND c.Id_culture IN (8,5)
GROUP BY name;

*TEST9

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, sum(DISTINCT cg.qtx_cult) as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.date_cult_affilied = cg.date_cult
AND c.Id_culture IN (8,5)
AND cg.Id_culture IN (8,5)
AND c.Id_culture IN (8,5)
GROUP BY name;

*TEST10

SELECT DISTINCT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, sum(cg.qtx_cult) as data
FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
WHERE f.id_type_field=tf.id_type_field
AND f.num_field=ica.Num_Field
AND ica.date_cult_affilied = cg.date_cult
AND ica.Id_culture IN (8,5)
AND cg.Id_culture IN (8,5)
AND c.Id_culture IN (8,5)
GROUP BY name, c.Id_culture,cg.Id_culture,ica.Id_culture;

*TEST11

SELECT DISTINCT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, SUM(cg.qtx_cult) as total_data
FROM field as f
JOIN type_field as tf ON f.id_type_field = tf.id_type_field
JOIN is_cult_affilied as ica ON f.num_field = ica.Num_Field
JOIN cult_give as cg ON ica.date_cult_affilied = cg.date_cult
JOIN culture as c ON ica.Id_culture = c.Id_culture
WHERE ica.Id_culture IN (8,5)
AND cg.Id_culture IN (8,5)
AND c.Id_culture IN (8,5)
GROUP BY name,c.Id_culture,cg.Id_culture,ica.Id_culture;

!Mauvaise piste

*TEST12

!-----------------------

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture=8
     AND cg.Id_culture=8
     AND c.Id_culture=8
     AND ica.date_cult_affilied = cg.date_cult;

*---------------------

SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture=5
     AND cg.Id_culture=5
     AND c.Id_culture=5
     AND ica.date_cult_affilied = cg.date_cult;

!--------------------
SELECT name, sum(data) FROM(SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture=8
     AND cg.Id_culture=8
     AND c.Id_culture=8
     AND ica.date_cult_affilied = cg.date_cult) as bet, (SELECT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture=5
     AND cg.Id_culture=5
     AND c.Id_culture=5
     AND ica.date_cult_affilied = cg.date_cult) as pdt 
     GROUP BY name 


*----------------------------------------------------------------
*---------good for pdt et betteraves-----------------------------
*----------------------------------------------------------------

SELECT total_data.name, sum(total_data.data)  as data
FROM(SELECT DISTINCT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, SUM(cg.qtx_cult) as data
FROM field as f
JOIN type_field as tf ON f.id_type_field = tf.id_type_field
JOIN is_cult_affilied as ica ON f.num_field = ica.Num_Field
JOIN cult_give as cg ON ica.date_cult_affilied = cg.date_cult
JOIN culture as c ON ica.Id_culture = c.Id_culture
WHERE ica.Id_culture IN (8,5)
AND cg.Id_culture IN (8,5)
AND c.Id_culture IN (8,5)
GROUP BY name,c.Id_culture,cg.Id_culture,ica.Id_culture) AS total_data
GROUP BY name 

!---------------------------------------------------------------
*-------------pdt et btt sans-----------------------------------
!---------------------------------------------------------------

 SELECT total_data.name, sum(total_data.data) as data
FROM(SELECT DISTINCT(tf.name_field) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c, is_treated as fit
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture IN (8,5)
     AND cg.Id_culture IN (8,5)
     AND c.Id_culture IN (8,5)
     AND ica.date_cult_affilied = cg.date_cult
     AND f.Num_Field NOT IN(Select fit.Num_Field from is_treated as fit)
GROUP BY name,c.Id_culture,cg.Id_culture,ica.Id_culture) AS total_data
GROUP BY name 

!----------------------------------------------------------------
*----------------------------------------------------------------
*---------pdt et betteraves avec cereal--------------------------
*----------------------------------------------------------------

SELECT total_data.name, sum(total_data.data)  as data
FROM(SELECT DISTINCT CONCAT(tf.name_field,' ',WITH_BONUS(f.Num_Field)) as name, SUM(cg.qtx_cult) as data
FROM field as f
JOIN type_field as tf ON f.id_type_field = tf.id_type_field
JOIN is_cult_affilied as ica ON f.num_field = ica.Num_Field
JOIN cult_give as cg ON ica.date_cult_affilied = cg.date_cult
JOIN culture as c ON ica.Id_culture = c.Id_culture
JOIN cereal as cer ON cer.Id_culture = c.Id_culture
WHERE ica.Id_culture IN (8,5,cer.Id_culture)
AND cg.Id_culture IN (8,5,cer.Id_culture)
AND c.Id_culture IN (8,5,cer.Id_culture) 
GROUP BY name,c.Id_culture,cg.Id_culture,ica.Id_culture) AS total_data
GROUP BY name 

!---------------------------------------------------------------
*-------------pdt et btt avec cereal sans-----------------------
!---------------------------------------------------------------

 SELECT total_data.name, sum(total_data.data) as data
FROM(SELECT DISTINCT(tf.name_field) as name, cg.qtx_cult as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c, is_treated as fit,cereal as cer
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture IN (8,5,cer.Id_culture)
     AND cg.Id_culture IN (8,5,cer.Id_culture)
     AND c.Id_culture IN (8,5,cer.Id_culture)
     AND ica.date_cult_affilied = cg.date_cult
     AND f.Num_Field NOT IN(Select fit.Num_Field from is_treated as fit)
GROUP BY name,c.Id_culture,cg.Id_culture,ica.Id_culture) AS total_data
GROUP BY name 

!-------------------------------------------------------
!-------------------------------------------------------
*------------------tot/cult-----------------------------
!-------------------------------------------------------
!-------------------------------------------------------

*-------------------Pdt

SELECT ue.label_under_earth as name, SUM(cg.qtx_cult) as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c, under_earth as ue
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture=5
     AND cg.Id_culture=5
     AND c.Id_culture=5
     AND ue.Id_culture=5
     AND ica.date_cult_affilied = cg.date_cult

*---------------------
*TEST1

SELECT total_data.name, sum(total_data.data)  as data
FROM(SELECT ue.label_under_earth as name, SUM(cg.qtx_cult) as data
FROM field as f
JOIN type_field as tf ON f.id_type_field = tf.id_type_field
JOIN is_cult_affilied as ica ON f.num_field = ica.Num_Field
JOIN cult_give as cg ON ica.date_cult_affilied = cg.date_cult
JOIN culture as c ON ica.Id_culture = c.Id_culture
JOIN cereal as cer ON cer.Id_culture = c.Id_culture
JOIN under_earth as ue ON ue.Id_culture = c.Id_culture
WHERE ica.Id_culture IN (8,5,cer.Id_culture)
AND cg.Id_culture IN (8,5,cer.Id_culture)
AND c.Id_culture IN (8,5,cer.Id_culture) 
GROUP BY name,c.Id_culture,cg.Id_culture,ica.Id_culture) AS total_data
GROUP BY name 

*------------------------------------------
*TEST2
SELECT DISTINCT ue.label_under_earth as name, SUM(cg.qtx_cult) as data
     FROM field as f,type_field as tf,cult_give as cg, is_cult_affilied as ica, culture as c, under_earth as ue
     WHERE f.id_type_field=tf.id_type_field
     AND f.num_field=ica.Num_Field
     AND ica.Id_culture IN (5,8)
     AND cg.Id_culture IN (5,8)
     AND c.Id_culture IN (5,8)
     AND ue.Id_culture IN (5,8)
     AND ica.date_cult_affilied = cg.date_cult;